<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="enONE">
<title>enONE_tutorial • enONE</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="enONE_tutorial">
<meta property="og:description" content="enONE">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">enONE</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-vignettes">Vignettes</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-vignettes">
    <a class="dropdown-item" href="../articles/enONE_tutorial.html">enONE Tutorial</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="nav-link" href="../../">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/thereallda/enONE">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>enONE_tutorial</h1>
            
      
      
      <div class="d-none name"><code>enONE_tutorial.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The hub metabolite, nicotinamide adenine dinucleotide (NAD), can be
used as an initiating nucleotide in RNA transcription to result in
NAD-capped RNAs (NAD-RNAs). Epitranscriptome-wide profiling of NAD-RNAs
involves chemo-enzymatic labeling and affinity-based enrichment; yet
currently available computational analysis cannot adequately remove
variations inherently linked with capture procedures. Here, we propose a
spike-in-based normalization and data-driven evaluation framework,
<code>enONE</code>, for the omic-level analysis of NAD-capped RNAs.</p>
<p><code>enONE</code> package is implemented in R and publicly available
at <a href="https://github.com/thereallda/enONE" class="external-link uri">https://github.com/thereallda/enONE</a>.</p>
</div>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<p>For this tutorial, we will demonstrate the <code>enONE</code>
workflow by using a NAD-RNA-seq data of peripheral blood mononuclear
cells (PBMCs) from beagle dogs with 14 days of NMN supplementation or
water gavage. Notably, we included three types of spike-in RNAs: 1)
total RNAs from <em>Drosophila melanogaster</em>, an invertebrate model
organism with well-annotated genome sequence, for estimating the
unwanted variation; 2) synthetic RNAs, consisting of 5% NAD- relative to
m7G-capped forms, were used to determine the capture sensitivity; 3)
synthetic RNAs, with 100% m7G-capped forms, were used to determine the
capture specificity (Figure 2A).</p>
<p>There are 36 samples that were sequenced on the Illumina Novaseq
6000. The raw data can be found at <a href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?&amp;acc=GSE221133" class="external-link">GSE221133</a>.</p>
<p><img src="images/paste-BE49259B.png"></p>
<p><em>Left panel: study design for NMN gavage experiment in beagle
dogs; Right panel: schematic workflow for total RNAs from dog PBMCs and
three sets of spike-ins.</em></p>
<p>We start by reading in the data, including count matrix and metadata.
It is recommended to provide the assay group of samples with the
<code>assay</code> column in metadata.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://thereallda.github.io/enONE/">enONE</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># read in metadata and counts matrix</span></span>
<span><span class="va">counts.mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="st">'../data/Counts.csv'</span>, row.names <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">meta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="st">'../data/metadata.csv'</span>, comment.char <span class="op">=</span> <span class="st">'#'</span><span class="op">)</span></span>
<span><span class="va">meta</span></span>
<span><span class="co">#&gt;     id       condition replicate  assay</span></span>
<span><span class="co">#&gt; 1   C1   D0_ctrl.Input         1  Input</span></span>
<span><span class="co">#&gt; 2   C2   D0_ctrl.Input         2  Input</span></span>
<span><span class="co">#&gt; 3   C3   D0_ctrl.Input         3  Input</span></span>
<span><span class="co">#&gt; 4   C5   D0_ctrl.Input         4  Input</span></span>
<span><span class="co">#&gt; 5   C6  D14_ctrl.Input         1  Input</span></span>
<span><span class="co">#&gt; 6   C7  D14_ctrl.Input         2  Input</span></span>
<span><span class="co">#&gt; 7   C8  D14_ctrl.Input         3  Input</span></span>
<span><span class="co">#&gt; 8  C10  D14_ctrl.Input         4  Input</span></span>
<span><span class="co">#&gt; 9  C11  D0_ctrl.Enrich         1 Enrich</span></span>
<span><span class="co">#&gt; 10 C12  D0_ctrl.Enrich         2 Enrich</span></span>
<span><span class="co">#&gt; 11 C13  D0_ctrl.Enrich         3 Enrich</span></span>
<span><span class="co">#&gt; 12 C15  D0_ctrl.Enrich         4 Enrich</span></span>
<span><span class="co">#&gt; 13 C16 D14_ctrl.Enrich         1 Enrich</span></span>
<span><span class="co">#&gt; 14 C17 D14_ctrl.Enrich         2 Enrich</span></span>
<span><span class="co">#&gt; 15 C18 D14_ctrl.Enrich         3 Enrich</span></span>
<span><span class="co">#&gt; 16 C20 D14_ctrl.Enrich         4 Enrich</span></span>
<span><span class="co">#&gt; 17  N1    D0_nmn.Input         1  Input</span></span>
<span><span class="co">#&gt; 18  N2    D0_nmn.Input         2  Input</span></span>
<span><span class="co">#&gt; 19  N3    D0_nmn.Input         3  Input</span></span>
<span><span class="co">#&gt; 20  N4    D0_nmn.Input         4  Input</span></span>
<span><span class="co">#&gt; 21  N5    D0_nmn.Input         5  Input</span></span>
<span><span class="co">#&gt; 22  N6   D14_nmn.Input         1  Input</span></span>
<span><span class="co">#&gt; 23  N7   D14_nmn.Input         2  Input</span></span>
<span><span class="co">#&gt; 24  N8   D14_nmn.Input         3  Input</span></span>
<span><span class="co">#&gt; 25  N9   D14_nmn.Input         4  Input</span></span>
<span><span class="co">#&gt; 26 N10   D14_nmn.Input         5  Input</span></span>
<span><span class="co">#&gt; 27 N11   D0_nmn.Enrich         1 Enrich</span></span>
<span><span class="co">#&gt; 28 N12   D0_nmn.Enrich         2 Enrich</span></span>
<span><span class="co">#&gt; 29 N13   D0_nmn.Enrich         3 Enrich</span></span>
<span><span class="co">#&gt; 30 N14   D0_nmn.Enrich         4 Enrich</span></span>
<span><span class="co">#&gt; 31 N15   D0_nmn.Enrich         5 Enrich</span></span>
<span><span class="co">#&gt; 32 N16  D14_nmn.Enrich         1 Enrich</span></span>
<span><span class="co">#&gt; 33 N17  D14_nmn.Enrich         2 Enrich</span></span>
<span><span class="co">#&gt; 34 N18  D14_nmn.Enrich         3 Enrich</span></span>
<span><span class="co">#&gt; 35 N19  D14_nmn.Enrich         4 Enrich</span></span>
<span><span class="co">#&gt; 36 N20  D14_nmn.Enrich         5 Enrich</span></span></code></pre></div>
<p>Next, we use the count matrix to create a <code>Enone</code> object.
The object serves as a container that contains both data (raw and
normalized counts data) and analysis (e.g., normalization performance
evaluation score and enrichment results) for a NAD-RNA-seq dataset.</p>
<p>When constructing <code>Enone</code> object, prefix of spike-in genes
(<code>spike.in.prefix = "^FB"</code>), the id of synthetic spike-in
(<code>synthetic.id = c("Syn1", "Syn2")</code>), and the id of input
(<code>input.id = "Input"</code>) and enrichment
(<code>enrich.id = "Enrich"</code>) samples can be provided.</p>
<blockquote>
<p>Syn1: 5% NAD-RNA;</p>
<p>Syn2: 100% m7G-RNA</p>
</blockquote>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># prefix of Drosophila spike-in genes</span></span>
<span><span class="va">spikeInPrefix</span> <span class="op">&lt;-</span> <span class="st">"^FB"</span></span>
<span></span>
<span><span class="co"># create Enone</span></span>
<span><span class="va">Enone</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createEnone.html">createEnone</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">counts.mat</span>,</span>
<span>                     bio.group <span class="op">=</span> <span class="va">meta</span><span class="op">$</span><span class="va">condition</span>,</span>
<span>                     enrich.group <span class="op">=</span> <span class="va">meta</span><span class="op">$</span><span class="va">assay</span>,</span>
<span>                     batch.group <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                     spike.in.prefix <span class="op">=</span> <span class="va">spikeInPrefix</span>,</span>
<span>                     synthetic.id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Syn1"</span>, <span class="st">"Syn2"</span><span class="op">)</span>,</span>
<span>                     input.id <span class="op">=</span> <span class="st">"Input"</span>,</span>
<span>                     enrich.id <span class="op">=</span> <span class="st">"Enrich"</span></span>
<span>                     <span class="op">)</span></span>
<span><span class="va">Enone</span></span>
<span><span class="co">#&gt; class: Enone </span></span>
<span><span class="co">#&gt; dim: 48735 36 </span></span>
<span><span class="co">#&gt; metadata(0):</span></span>
<span><span class="co">#&gt; assays(1): ''</span></span>
<span><span class="co">#&gt; rownames(48735): ENSCAFG00845015183 ENSCAFG00845015195 ... Syn1 Syn2</span></span>
<span><span class="co">#&gt; rowData names(3): GeneID SpikeIn Synthetic</span></span>
<span><span class="co">#&gt; colnames(36): C1 C2 ... N19 N20</span></span>
<span><span class="co">#&gt; colData names(5): id condition enrich replicate batch</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="standard-workflow">Standard workflow<a class="anchor" aria-label="anchor" href="#standard-workflow"></a>
</h2>
<p>The <code>enONE</code> workflow consists of four steps: 1) Quality
control; 2) Gene set selection; 3) Normalization procedures; 4)
Normalization performance assessment.</p>
<div class="section level3">
<h3 id="quality-control">Quality Control<a class="anchor" aria-label="anchor" href="#quality-control"></a>
</h3>
<p><code>enONE</code> initiate with quality control step to filter
lowly-expressed genes. This step is performed with
<code>filterByExpr</code> from <code>edgeR</code> package.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">keep</span> <span class="op">&lt;-</span> <span class="fu">edgeR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/edgeR/man/filterByExpr.html" class="external-link">filterByExpr</a></span><span class="op">(</span><span class="va">counts.mat</span>, group <span class="op">=</span> <span class="va">meta</span><span class="op">$</span><span class="va">condition</span><span class="op">)</span></span>
<span><span class="va">Enone</span> <span class="op">&lt;-</span> <span class="va">Enone</span><span class="op">[</span><span class="va">keep</span>, <span class="op">]</span></span>
<span><span class="va">Enone</span></span>
<span><span class="co">#&gt; class: Enone </span></span>
<span><span class="co">#&gt; dim: 28795 36 </span></span>
<span><span class="co">#&gt; metadata(0):</span></span>
<span><span class="co">#&gt; assays(1): ''</span></span>
<span><span class="co">#&gt; rownames(28795): ENSCAFG00845015217 ENSCAFG00845015316 ... Syn1 Syn2</span></span>
<span><span class="co">#&gt; rowData names(3): GeneID SpikeIn Synthetic</span></span>
<span><span class="co">#&gt; colnames(36): C1 C2 ... N19 N20</span></span>
<span><span class="co">#&gt; colData names(5): id condition enrich replicate batch</span></span></code></pre></div>
<p>Additionally, outliers can be assessed by Rosner’s outlier test on
principal component 1. Since no sample is flagged as outlier, we will
use all samples in following analysis.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## ronser's test for outlier assessment</span></span>
<span><span class="va">vt</span> <span class="op">&lt;-</span> <span class="fu">DESeq2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DESeq2/man/vst.html" class="external-link">vst</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fu">SummarizedExperiment</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">assay</a></span><span class="op">(</span><span class="va">Enone</span><span class="op">)</span><span class="op">)</span>, nsub <span class="op">=</span> <span class="fl">20000</span><span class="op">)</span></span>
<span><span class="va">pc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html" class="external-link">prcomp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">vt</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## all samples pass the test</span></span>
<span><span class="fu">EnvStats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/EnvStats/man/rosnerTest.html" class="external-link">rosnerTest</a></span><span class="op">(</span><span class="va">pc</span><span class="op">$</span><span class="va">x</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">$</span><span class="va">all.stats</span></span>
<span><span class="co">#&gt;   i        Mean.i     SD.i    Value Obs.Num    R.i+1 lambda.i+1 Outlier</span></span>
<span><span class="co">#&gt; 1 0  4.350301e-15 118.1289 144.0791      32 1.219678   2.990585   FALSE</span></span>
<span><span class="co">#&gt; 2 1 -4.116547e+00 117.2043 138.1465      28 1.213804   2.978183   FALSE</span></span>
<span><span class="co">#&gt; 3 2 -8.300754e+00 116.2832 133.1332      27 1.216288   2.965315   FALSE</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="running-enone">Running enONE<a class="anchor" aria-label="anchor" href="#running-enone"></a>
</h3>
<p>The main <code>enONE</code> function can be used to perform gene
selection, normalization, and evaluation. This function return selected
gene set in <code>rowData</code>, normalized count matrix in
<code>counts</code> slot (when <code>return.norm=TRUE</code>),
normalization factors (<code>enone_factor</code> slot), evaluation
metrics and scores in <code>enone_metrics</code> and
<code>enone_scores</code> slots, respectively. Detailed of these steps
are described bellow.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Enone</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/enONE.html">enONE</a></span><span class="op">(</span><span class="va">Enone</span>, </span>
<span>               scaling.method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"TC"</span>, <span class="st">"UQ"</span>, <span class="st">"TMM"</span>, <span class="st">"DESeq"</span>, <span class="st">"PossionSeq"</span><span class="op">)</span>,</span>
<span>               ruv.norm <span class="op">=</span> <span class="cn">TRUE</span>, ruv.k <span class="op">=</span> <span class="fl">3</span>,</span>
<span>               eval.pam.k <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fl">6</span>, eval.pc.n <span class="op">=</span> <span class="fl">3</span>,</span>
<span>               return.norm <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>               <span class="op">)</span></span>
<span><span class="co">#&gt; Gene set selection for normalization and assessment...</span></span>
<span><span class="co">#&gt; - The number of negative control genes for normalization: 1000 </span></span>
<span><span class="co">#&gt; - The number of positive evaluation genes: 500 </span></span>
<span><span class="co">#&gt; - The number of negative evaluation genes: 500 </span></span>
<span><span class="co">#&gt; Apply normalization...</span></span>
<span><span class="co">#&gt; Perform assessment...</span></span></code></pre></div>
<div class="section level4">
<h4 id="gene-set-selection">Gene set Selection<a class="anchor" aria-label="anchor" href="#gene-set-selection"></a>
</h4>
<p>For gene set selection, enONE defined three sets of control genes,
including:</p>
<ul>
<li><p>Negative Control (<code>NegControl</code>): By default,
<code>enONE</code> define the 1,000 least significantly enriched genes
in <em>Drosophila</em> spike-ins (or other RNA spike-in from exogenous
organism), ranked by edgeR FDR values, as the negative controls for
adjustment of the unwanted variations.</p></li>
<li><p>Negative Evaluation (<code>NegEvaluation</code>): By default,
<code>enONE</code> define the 500 least significantly varied genes in
samples of interest, ranked by edgeR FDR values, as negative evaluation
genes for evaluation of the unwanted variations.</p></li>
<li><p>Positive Evaluation (<code>PosEvaluation</code>): By default,
<code>enONE</code> define the 500 most significantly enriched genes in
samples of interest, ranked by edgeR FDR values, as positive evaluation
genes for evaluation of the wanted variations.</p></li>
</ul>
<p>Gene selection can either be automatically defined in
<code>enONE</code> function with <code>auto=TRUE</code> parameter, or be
provided in <code>neg.control, pos.eval, neg.eval</code> parameters,
respectively.</p>
<p>Selected gene sets can be assessed by <code>getGeneSet</code> with
the name of gene set (i.e., <code>"NegControl"</code>,
<code>"NegEvaluation"</code>, <code>"PosEvaluation"</code>).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/getGeneSet.html">getGeneSet</a></span><span class="op">(</span><span class="va">Enone</span>, <span class="st">"NegControl"</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] "FBgn0267987" "FBgn0266906" "FBgn0031256" "FBgn0266032" "FBgn0031285"</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="normalization">Normalization<a class="anchor" aria-label="anchor" href="#normalization"></a>
</h4>
<p><code>enONE</code> implements global scaling and regression-based
methods for the generation of normalization procedures.</p>
<p>For the global scaling normalization procedures, five different
scaling procedures are implemented, including 1) Total Count (TC); 2)
Upper-Quartile (UQ); 3) Trimmed Mean of M Values (TMM); 4) DESeq; 5)
PossionSeq. Users can perform with selected scaling procedures in
<code>scaling.method</code> parameter.</p>
<p>For the regression-based procedures, <code>enONE</code> use three
variants of RUV to estimate the factors of unwanted variation,
including: 1) RUVg; 2) RUVs; 3) RUVse. For instance, you can perform RUV
with selected the first two unwanted factors with
<code>ruv.norm =TRUE, ruv.k=2</code>.</p>
<blockquote>
<p>RUVse is a modification of RUVs. It estimated the factors of unwanted
variation based on negative control genes from the replicate samples in
each assay group (i.e., enrichment and input), for which the enrichment
effect was assumed to be constant.</p>
</blockquote>
<p>All applied normalization methods can be assessed by
<code>list</code></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/listNormalization.html">listNormalization</a></span><span class="op">(</span><span class="va">Enone</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "TC"                  "UQ"                  "TMM"                </span></span>
<span><span class="co">#&gt;  [4] "DESeq"               "PossionSeq"          "Raw"                </span></span>
<span><span class="co">#&gt;  [7] "TC_RUVg_k1"          "TC_RUVs_k1"          "TC_RUVse_k1"        </span></span>
<span><span class="co">#&gt; [10] "TC_RUVg_k2"          "TC_RUVs_k2"          "TC_RUVse_k2"        </span></span>
<span><span class="co">#&gt; [13] "TC_RUVg_k3"          "TC_RUVs_k3"          "TC_RUVse_k3"        </span></span>
<span><span class="co">#&gt; [16] "UQ_RUVg_k1"          "UQ_RUVs_k1"          "UQ_RUVse_k1"        </span></span>
<span><span class="co">#&gt; [19] "UQ_RUVg_k2"          "UQ_RUVs_k2"          "UQ_RUVse_k2"        </span></span>
<span><span class="co">#&gt; [22] "UQ_RUVg_k3"          "UQ_RUVs_k3"          "UQ_RUVse_k3"        </span></span>
<span><span class="co">#&gt; [25] "TMM_RUVg_k1"         "TMM_RUVs_k1"         "TMM_RUVse_k1"       </span></span>
<span><span class="co">#&gt; [28] "TMM_RUVg_k2"         "TMM_RUVs_k2"         "TMM_RUVse_k2"       </span></span>
<span><span class="co">#&gt; [31] "TMM_RUVg_k3"         "TMM_RUVs_k3"         "TMM_RUVse_k3"       </span></span>
<span><span class="co">#&gt; [34] "DESeq_RUVg_k1"       "DESeq_RUVs_k1"       "DESeq_RUVse_k1"     </span></span>
<span><span class="co">#&gt; [37] "DESeq_RUVg_k2"       "DESeq_RUVs_k2"       "DESeq_RUVse_k2"     </span></span>
<span><span class="co">#&gt; [40] "DESeq_RUVg_k3"       "DESeq_RUVs_k3"       "DESeq_RUVse_k3"     </span></span>
<span><span class="co">#&gt; [43] "PossionSeq_RUVg_k1"  "PossionSeq_RUVs_k1"  "PossionSeq_RUVse_k1"</span></span>
<span><span class="co">#&gt; [46] "PossionSeq_RUVg_k2"  "PossionSeq_RUVs_k2"  "PossionSeq_RUVse_k2"</span></span>
<span><span class="co">#&gt; [49] "PossionSeq_RUVg_k3"  "PossionSeq_RUVs_k3"  "PossionSeq_RUVse_k3"</span></span>
<span><span class="co">#&gt; [52] "Raw_RUVg_k1"         "Raw_RUVs_k1"         "Raw_RUVse_k1"       </span></span>
<span><span class="co">#&gt; [55] "Raw_RUVg_k2"         "Raw_RUVs_k2"         "Raw_RUVse_k2"       </span></span>
<span><span class="co">#&gt; [58] "Raw_RUVg_k3"         "Raw_RUVs_k3"         "Raw_RUVse_k3"</span></span></code></pre></div>
<p>Normalized counts can be assessed by <code>Counts</code></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/Counts.html">Counts</a></span><span class="op">(</span><span class="va">Enone</span>, slot<span class="op">=</span><span class="st">"sample"</span>, method<span class="op">=</span><span class="st">"TMM_RUVse_k3"</span><span class="op">)</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span>
<span><span class="co">#&gt;                             C1          C2          C3          C5          C6</span></span>
<span><span class="co">#&gt; ENSCAFG00845015217   0.1270775   0.1580804   0.5073167   0.1972178   0.1473110</span></span>
<span><span class="co">#&gt; ENSCAFG00845015316   0.6467976   1.1029219   0.7496786   0.9257258   0.6365079</span></span>
<span><span class="co">#&gt; ENSCAFG00845015457 213.0782649 191.3361797 145.7496546 223.9916657 182.9394510</span></span>
<span><span class="co">#&gt; ENSCAFG00845015550  22.7519362  26.4536677  24.4529529  20.3535993  24.0241785</span></span>
<span><span class="co">#&gt; ENSCAFG00845015637   4.1985951   4.7444409   4.4990044   4.1284498   5.3711438</span></span>
<span><span class="co">#&gt; ENSCAFG00845015701   4.7503025   5.2315408   5.1139479   6.6107143   6.7737966</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="evaluation">Evaluation<a class="anchor" aria-label="anchor" href="#evaluation"></a>
</h4>
<p>To evaluate the performance of normalization, <code>enONE</code>
leverages eight normalization performance metrics that related to
different aspects of the distribution of gene expression measures. The
eight metrics are listed as below:</p>
<ol style="list-style-type: decimal">
<li><p><code>BIO_SIM</code>: Similarity of biological groups. The
average silhouette width of clusters defined by <code>bio.group</code>,
computed with the Euclidean distance metric over the first 3 expression
PCs (default). Large values of <code>BIO_SIM</code> is
desirable.</p></li>
<li><p><code>EN_SIM</code>: Similarity of enrichment groups. The average
silhouette width of clusters defined by <code>en.group</code>, computed
with the Euclidean distance metric over the first 3 expression PCs
(default). Large values of <code>EN_SIM</code> is desirable.</p></li>
<li><p><code>BAT_SIM</code>: Similarity of batch groups. The average
silhouette width of clusters defined by <code>batch.group</code>,
computed with the Euclidean distance metric over the first 3 expression
PCs (default). Low values of <code>BAT_SIM</code> is desirable.</p></li>
<li><p><code>PAM_SIM</code>: Similarity of PAM clustering groups. The
maximum average silhouette width of clusters defined by PAM clustering
(cluster by <code>eval.pam.k</code>), computed with the Euclidean
distance metric over the first 3 expression PCs (default). Large values
of <code>BAT_SIM</code> is desirable.</p></li>
<li><p><code>WV_COR</code>: Preservation of biological variation. R^2
measure for regression of first 3 expression PCs on first
<code>eval.pc.n</code> PCs of the positive evaluation genes
(<code>PosEvaluation</code>) sub-matrix of the raw count. Large values
of <code>WV_COR</code> is desirable.</p></li>
<li><p><code>UV_COR</code>: Removal of unwanted variation. R^2 measure
for regression of first 3 expression PCs on first <code>eval.pc.n</code>
PCs of the negative evaluation genes (<code>NegEvaluation</code>)
sub-matrix of the raw count. Low values of <code>UV_COR</code> is
desirable.</p></li>
<li><p><code>RLE_MED</code>: The mean squared-median Relative Log
Expression (RLE). Low values of <code>RLE_MED</code> is
desirable.</p></li>
<li><p><code>RLE_IQR</code>: The variance of inter-quartile range (IQR)
of RLE. Low values of <code>RLE_IQR</code> is desirable.</p></li>
</ol>
<p>Evaluation metrics can be assessed by <code>getMetrics</code></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/getMetrics.html">getMetrics</a></span><span class="op">(</span><span class="va">Enone</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,<span class="op">]</span></span>
<span><span class="co">#&gt;                        BIO_SIM    EN_SIM BATCH_SIM   PAM_SIM      RLE_MED</span></span>
<span><span class="co">#&gt; TMM_RUVse_k3       0.004010675 0.3672915         0 0.7215727 0.0012331000</span></span>
<span><span class="co">#&gt; TMM_RUVs_k3        0.264969797 0.3526664         0 0.6917263 0.0013922471</span></span>
<span><span class="co">#&gt; TMM_RUVs_k2        0.273545725 0.3529028         0 0.6912465 0.0014106631</span></span>
<span><span class="co">#&gt; PossionSeq_RUVs_k2 0.162922204 0.3557378         0 0.6791057 0.0001844717</span></span>
<span><span class="co">#&gt; TMM_RUVs_k1        0.323222896 0.3572111         0 0.6832383 0.0017360384</span></span>
<span><span class="co">#&gt;                       RLE_IQR    WV_COR    UV_COR</span></span>
<span><span class="co">#&gt; TMM_RUVse_k3       0.02174805 0.8464516 0.3908795</span></span>
<span><span class="co">#&gt; TMM_RUVs_k3        0.02437620 0.6853092 0.1459999</span></span>
<span><span class="co">#&gt; TMM_RUVs_k2        0.02708899 0.7287250 0.1508830</span></span>
<span><span class="co">#&gt; PossionSeq_RUVs_k2 0.07336386 0.9182946 0.2784424</span></span>
<span><span class="co">#&gt; TMM_RUVs_k1        0.03318628 0.8619031 0.2170877</span></span></code></pre></div>
<p>Evaluation score is the average rank of each performance metrics,
which can be assessed by <code>getScore</code></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/getScore.html">getScore</a></span><span class="op">(</span><span class="va">Enone</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,<span class="op">]</span></span>
<span><span class="co">#&gt;                    BIO_SIM EN_SIM BATCH_SIM PAM_SIM RLE_MED RLE_IQR WV_COR</span></span>
<span><span class="co">#&gt; TMM_RUVse_k3            29     54         1      48      47      45     15</span></span>
<span><span class="co">#&gt; TMM_RUVs_k3             50     36         1      36      46      37      3</span></span>
<span><span class="co">#&gt; TMM_RUVs_k2             52     37         1      35      45      31      8</span></span>
<span><span class="co">#&gt; PossionSeq_RUVs_k2      43     43         1      17      59       7     43</span></span>
<span><span class="co">#&gt; TMM_RUVs_k1             55     47         1      25      39      22     19</span></span>
<span><span class="co">#&gt;                    UV_COR    SCORE</span></span>
<span><span class="co">#&gt; TMM_RUVse_k3           29 38.14286</span></span>
<span><span class="co">#&gt; TMM_RUVs_k3            58 38.00000</span></span>
<span><span class="co">#&gt; TMM_RUVs_k2            57 37.85714</span></span>
<span><span class="co">#&gt; PossionSeq_RUVs_k2     50 37.42857</span></span>
<span><span class="co">#&gt; TMM_RUVs_k1            53 37.14286</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="select-the-suitable-normalization-for-subsequent-analysis">Select the suitable normalization for subsequent analysis<a class="anchor" aria-label="anchor" href="#select-the-suitable-normalization-for-subsequent-analysis"></a>
</h2>
<p><code>enONE</code> provides biplot to exploit the full space of
normalization methods, you can turn on the interactive mode with
<code>interactive=TRUE</code>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get performance score</span></span>
<span><span class="va">enScore</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getScore.html">getScore</a></span><span class="op">(</span><span class="va">Enone</span><span class="op">)</span></span>
<span><span class="co"># perform PCA based on evaluation score, excluding BAT_SIM column (3) for no batch information provided, and SCORE column (9).</span></span>
<span><span class="va">pca.eval</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html" class="external-link">prcomp</a></span><span class="op">(</span><span class="va">enScore</span><span class="op">[</span>,<span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">9</span><span class="op">)</span><span class="op">]</span>, scale <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># pca biplot</span></span>
<span><span class="fu"><a href="../reference/PCA_Biplot.html">PCA_Biplot</a></span><span class="op">(</span><span class="va">pca.eval</span>, score <span class="op">=</span> <span class="va">enScore</span><span class="op">$</span><span class="va">SCORE</span>, interactive <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="enONE_tutorial_files/figure-html/unnamed-chunk-12-1.png" width="960"></p>
<p>In this plot, each point corresponds to a normalization procedure and
is colored by the performance score (mean of eight scone performance
metric ranks). The blue arrows correspond to the PCA loadings for the
performance metrics. The direction and length of a blue arrow can be
interpreted as a measure of how much each metric contributed to the
first two PCs</p>
<p>Here, we use the top-ranked procedure TMM_RUVse_k3 for downstream
analysis.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># select normalization</span></span>
<span><span class="va">norm.method</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">enScore</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># get normalized counts</span></span>
<span><span class="va">norm.data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Counts.html">Counts</a></span><span class="op">(</span><span class="va">Enone</span>, slot <span class="op">=</span> <span class="st">'sample'</span>, method <span class="op">=</span> <span class="va">norm.method</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># get normalization factors</span></span>
<span><span class="va">norm.factors</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getFactor.html">getFactor</a></span><span class="op">(</span><span class="va">Enone</span>, slot <span class="op">=</span> <span class="st">'sample'</span>, method <span class="op">=</span> <span class="va">norm.method</span><span class="op">)</span></span>
<span></span>
<span><span class="va">norm.method</span></span>
<span><span class="co">#&gt; [1] "TMM_RUVse_k3"</span></span></code></pre></div>
<blockquote>
<p>To be noted, if normalized counts are not returned in
<code>enONE</code> run step, you have to mannually perform the
normalization method, before get the corresponding normalized counts,
e.g.,</p>
</blockquote>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># perform normalization</span></span>
<span><span class="va">Enone</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/UseNormalization.html">UseNormalization</a></span><span class="op">(</span><span class="va">Enone</span>, slot <span class="op">=</span> <span class="st">'sample'</span>, method <span class="op">=</span> <span class="st">'TMM_RUVse_k3'</span><span class="op">)</span></span>
<span><span class="co"># get normalized counts</span></span>
<span><span class="va">norm.data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Counts.html">Counts</a></span><span class="op">(</span><span class="va">Enone</span>, slot <span class="op">=</span> <span class="st">'sample'</span>, method <span class="op">=</span> <span class="va">norm.method</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="effect-of-normalization">Effect of normalization<a class="anchor" aria-label="anchor" href="#effect-of-normalization"></a>
</h2>
<p>We perform PCA based on the count matrix from sample of interest
before and after the normalization, for demonstrating the effect of
normalization.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create sample name, e.g., D0_ctrl.Input.1</span></span>
<span><span class="va">samples_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">Enone</span><span class="op">$</span><span class="va">condition</span>, <span class="va">Enone</span><span class="op">$</span><span class="va">replicate</span>, sep<span class="op">=</span><span class="st">'.'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># PCA for raw count</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/PCAplot.html">PCAplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log1p</a></span><span class="op">(</span><span class="fu"><a href="../reference/Counts.html">Counts</a></span><span class="op">(</span><span class="va">Enone</span>, slot<span class="op">=</span><span class="st">'sample'</span>, <span class="st">'Raw'</span><span class="op">)</span><span class="op">)</span>, </span>
<span>            color <span class="op">=</span> <span class="va">Enone</span><span class="op">$</span><span class="va">condition</span>,</span>
<span>            label <span class="op">=</span> <span class="va">samples_name</span>, vst.norm <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">'Before normalization'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># PCA for normalized count</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/PCAplot.html">PCAplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log1p</a></span><span class="op">(</span><span class="va">norm.data</span><span class="op">)</span>, </span>
<span>            color <span class="op">=</span> <span class="va">Enone</span><span class="op">$</span><span class="va">condition</span>,</span>
<span>            label <span class="op">=</span> <span class="va">samples_name</span>, vst.norm <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">'After normalization'</span><span class="op">)</span></span>
<span><span class="va">p1</span> <span class="op">+</span> <span class="va">p2</span></span></code></pre></div>
<p><img src="enONE_tutorial_files/figure-html/unnamed-chunk-15-1.png" width="1152"></p>
</div>
<div class="section level2">
<h2 id="find-enrichment">Find enrichment<a class="anchor" aria-label="anchor" href="#find-enrichment"></a>
</h2>
<p><code>enONE</code> package can help you find enrichment genes from
each biological groups via differential expression. It can identify
genes that significantly increased in enrichment samples compared to
input samples. <code>FindEnrichment</code> automates this processes for
all groups provided in <code>bio.group</code>.</p>
<p>By default, enriched genes (NAD-RNA in here) are defined as fold
change of normalized transcript counts ≥ 2
(<code>logfc.cutoff = 1</code>), FDR &lt; 0.05
(<code>p.cutoff = 0.05</code>) in enrichment samples compared to those
in input samples.</p>
<p>Use <code>getEnrichment</code> to retrieve a list of enrichment
result tables.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># find all enriched genes</span></span>
<span><span class="va">Enone</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/FindEnrichment.html">FindEnrichment</a></span><span class="op">(</span><span class="va">Enone</span>, slot<span class="op">=</span><span class="st">'sample'</span>, method <span class="op">=</span> <span class="va">norm.method</span>, </span>
<span>                        logfc.cutoff <span class="op">=</span> <span class="fl">1</span>, p.cutoff <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="co"># get filtered enrichment results</span></span>
<span><span class="va">res.sig.ls</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getEnrichment.html">getEnrichment</a></span><span class="op">(</span><span class="va">Enone</span>, slot<span class="op">=</span><span class="st">'sample'</span>, filter<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># count number of enrichment in each group</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">res.sig.ls</span>, <span class="va">nrow</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   D0_ctrl.Enrich_D0_ctrl.Input D14_ctrl.Enrich_D14_ctrl.Input </span></span>
<span><span class="co">#&gt;                           2167                           2102 </span></span>
<span><span class="co">#&gt;     D0_nmn.Enrich_D0_nmn.Input   D14_nmn.Enrich_D14_nmn.Input </span></span>
<span><span class="co">#&gt;                           2688                           2402</span></span></code></pre></div>
<p>Each enrichment table is a <code>data.frame</code> with a list of
genes as rows, and associated information as columns (GeneID, logFC,
p-values, etc.). The following columns are present in the table:</p>
<ul>
<li>
<code>GeneID</code>: ID of genes.</li>
<li>
<code>logFC</code>: log2 fold-change between enrichment and input
samples. Positive values indicate that the gene is more highly enriched
in the enrichment group.</li>
<li>
<code>logCPM</code>: log2 CPM (counts per million) of the average
expression of all samples.</li>
<li>
<code>LR</code>: Likelihood ratio of the likelihood ratio test.</li>
<li>
<code>PValue</code>: p-value from the likelihood ratio test.</li>
<li>
<code>FDR</code>: False discovery rate of the p-value, default “BH”
method is applied.</li>
</ul>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">res.sig.ls</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;               GeneID    logFC    logCPM       LR        PValue           FDR</span></span>
<span><span class="co">#&gt; 1 ENSCAFG00845007784 2.959802  8.717648 509.4189 8.484765e-113 1.231648e-108</span></span>
<span><span class="co">#&gt; 2 ENSCAFG00845002083 3.157457 12.584706 375.8864  9.784997e-84  7.101951e-80</span></span>
<span><span class="co">#&gt; 3 ENSCAFG00845009430 2.510118  7.642940 340.5231  4.908601e-76  2.375108e-72</span></span>
<span><span class="co">#&gt; 4 ENSCAFG00845000887 2.287440  7.351301 299.2720  4.746529e-67  1.722515e-63</span></span>
<span><span class="co">#&gt; 5 ENSCAFG00845007809 3.177614  6.102379 295.1592  3.736355e-66  1.084738e-62</span></span>
<span><span class="co">#&gt; 6 ENSCAFG00845016135 2.327771  9.398165 293.5746  8.273551e-66  2.001648e-62</span></span></code></pre></div>
<p>To convert list of enrichment result tables into data frame in long
format, <code>enONE</code> package provide <code>reduceRes</code>
function for this task. Finally, you can use
<code>BetweenStatPlot</code> to compare the global extent of NAD-RNA
modification level between groups.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># simplify group id</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">res.sig.ls</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'D0.Water'</span>, <span class="st">'D14.Water'</span>, <span class="st">'D0.NMN'</span>, <span class="st">'D14.NMN'</span><span class="op">)</span></span>
<span><span class="co"># logfc.col specify the name of logFC column</span></span>
<span><span class="va">nad_df1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reduceRes.html">reduceRes</a></span><span class="op">(</span><span class="va">res.sig.ls</span>, logfc.col <span class="op">=</span> <span class="st">'logFC'</span><span class="op">)</span></span>
<span><span class="co"># convert the Group column as factor</span></span>
<span><span class="va">nad_df1</span><span class="op">$</span><span class="va">Group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">nad_df1</span><span class="op">$</span><span class="va">Group</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">nad_df1</span><span class="op">$</span><span class="va">Group</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># draw plot</span></span>
<span><span class="va">bxp1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/BetweenStatPlot.html">BetweenStatPlot</a></span><span class="op">(</span><span class="va">nad_df1</span>, x<span class="op">=</span><span class="st">'Group'</span>, y<span class="op">=</span><span class="st">'logFC'</span>, color<span class="op">=</span><span class="st">'Group'</span>, </span>
<span>                        step.increase <span class="op">=</span> <span class="fl">0.6</span>, add.p <span class="op">=</span> <span class="st">'p'</span>, </span>
<span>                        comparisons <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'D0.Water'</span>, <span class="st">'D14.Water'</span><span class="op">)</span>, </span>
<span>                                           <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'D0.NMN'</span>, <span class="st">'D14.NMN'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">bxp1</span></span></code></pre></div>
<p><img src="enONE_tutorial_files/figure-html/unnamed-chunk-18-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="handling-synthetic-spike-in-rna">Handling synthetic spike-in RNA<a class="anchor" aria-label="anchor" href="#handling-synthetic-spike-in-rna"></a>
</h2>
<p>Since synthetic RNA, of which one with 5% NAD-caps and another with
100% m7G-caps, are included, we can determine the capture sensitivity
and specificity.</p>
<p><code>synEnrichment</code> calculate the enrichment levels of
spike-in with given normalization method. <code>DotPlot</code> can be
used to visualize the enrichment levels of synthetic spike-in.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># compute synthetic spike-in enrichment</span></span>
<span><span class="va">syn_level</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/synEnrichment.html">synEnrichment</a></span><span class="op">(</span><span class="va">Enone</span>, method<span class="op">=</span><span class="va">norm.method</span>, log<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># transform to long format</span></span>
<span><span class="va">syn_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">syn_level</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html" class="external-link">rownames_to_column</a></span><span class="op">(</span><span class="st">"syn_id"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="op">-</span><span class="va">syn_id</span>,</span>
<span>               names_to <span class="op">=</span> <span class="st">"id"</span>,</span>
<span>               values_to <span class="op">=</span> <span class="st">"logFC"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">meta</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>,<span class="st">"condition"</span><span class="op">)</span><span class="op">]</span>, by<span class="op">=</span><span class="st">"id"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># remove suffix of condition for simplification</span></span>
<span><span class="va">syn_df</span><span class="op">$</span><span class="va">condition</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"\\..*"</span>, <span class="st">""</span>, <span class="va">syn_df</span><span class="op">$</span><span class="va">condition</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># rename facet label</span></span>
<span><span class="va">samples_label</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'5% NAD-RNA'</span>, <span class="st">'100% m7G-RNA'</span><span class="op">)</span>, </span>
<span>                          nm<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Syn1'</span>, <span class="st">'Syn2'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># draw dotplot</span></span>
<span><span class="fu"><a href="../reference/DotPlot.html">DotPlot</a></span><span class="op">(</span><span class="va">syn_df</span>, x<span class="op">=</span><span class="st">"condition"</span>, y<span class="op">=</span><span class="st">"logFC"</span>, fill<span class="op">=</span><span class="st">"condition"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">syn_id</span>, labeller <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/as_labeller.html" class="external-link">as_labeller</a></span><span class="op">(</span><span class="va">samples_label</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">'none'</span><span class="op">)</span></span>
<span><span class="co">#&gt; Bin width defaults to 1/30 of the range of the data. Pick better value with</span></span>
<span><span class="co">#&gt; `binwidth`.</span></span></code></pre></div>
<p><img src="enONE_tutorial_files/figure-html/unnamed-chunk-19-1.png" width="700"></p>
<p>Syn1, which contained 5% NAD-RNA, are significantly enriched, whereas
no enrichment is found for Syn2 made up with 100% m7G-RNA.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># save Enone data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">Enone</span>, file<span class="op">=</span><span class="st">"data/Enone.RData"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="session-info">Session Info<a class="anchor" aria-label="anchor" href="#session-info"></a>
</h2>
<details><summary><strong>Session Info</strong>
</summary><div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; R version 4.2.2 (2022-10-31)</span></span>
<span><span class="co">#&gt; Platform: x86_64-pc-linux-gnu (64-bit)</span></span>
<span><span class="co">#&gt; Running under: Ubuntu 22.04.1 LTS</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Matrix products: default</span></span>
<span><span class="co">#&gt; BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3</span></span>
<span><span class="co">#&gt; LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.20.so</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; locale:</span></span>
<span><span class="co">#&gt;  [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8       </span></span>
<span><span class="co">#&gt;  [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8   </span></span>
<span><span class="co">#&gt;  [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C          </span></span>
<span><span class="co">#&gt; [10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C   </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attached base packages:</span></span>
<span><span class="co">#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; other attached packages:</span></span>
<span><span class="co">#&gt;  [1] patchwork_1.1.2 forcats_0.5.2   stringr_1.5.0   dplyr_1.0.10   </span></span>
<span><span class="co">#&gt;  [5] purrr_1.0.0     readr_2.1.3     tidyr_1.2.1     tibble_3.1.8   </span></span>
<span><span class="co">#&gt;  [9] ggplot2_3.4.0   tidyverse_1.3.2 enONE_0.1.0    </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; loaded via a namespace (and not attached):</span></span>
<span><span class="co">#&gt;   [1] readxl_1.4.1                backports_1.4.1            </span></span>
<span><span class="co">#&gt;   [3] systemfonts_1.0.4           lazyeval_0.2.2             </span></span>
<span><span class="co">#&gt;   [5] splines_4.2.2               BiocParallel_1.30.4        </span></span>
<span><span class="co">#&gt;   [7] GenomeInfoDb_1.32.4         digest_0.6.31              </span></span>
<span><span class="co">#&gt;   [9] htmltools_0.5.4             fansi_1.0.3                </span></span>
<span><span class="co">#&gt;  [11] magrittr_2.0.3              memoise_2.0.1              </span></span>
<span><span class="co">#&gt;  [13] googlesheets4_1.0.1         cluster_2.1.4              </span></span>
<span><span class="co">#&gt;  [15] tzdb_0.3.0                  limma_3.52.4               </span></span>
<span><span class="co">#&gt;  [17] Biostrings_2.64.1           annotate_1.74.0            </span></span>
<span><span class="co">#&gt;  [19] modelr_0.1.10               matrixStats_0.63.0         </span></span>
<span><span class="co">#&gt;  [21] timechange_0.1.1            pkgdown_2.0.7              </span></span>
<span><span class="co">#&gt;  [23] colorspace_2.0-3            blob_1.2.3                 </span></span>
<span><span class="co">#&gt;  [25] rvest_1.0.3                 ggrepel_0.9.2              </span></span>
<span><span class="co">#&gt;  [27] textshaping_0.3.6           haven_2.5.1                </span></span>
<span><span class="co">#&gt;  [29] xfun_0.36                   crayon_1.5.2               </span></span>
<span><span class="co">#&gt;  [31] RCurl_1.98-1.9              jsonlite_1.8.4             </span></span>
<span><span class="co">#&gt;  [33] EnvStats_2.7.0              genefilter_1.78.0          </span></span>
<span><span class="co">#&gt;  [35] survival_3.4-0              glue_1.6.2                 </span></span>
<span><span class="co">#&gt;  [37] gtable_0.3.1                gargle_1.2.1               </span></span>
<span><span class="co">#&gt;  [39] zlibbioc_1.42.0             XVector_0.36.0             </span></span>
<span><span class="co">#&gt;  [41] DelayedArray_0.22.0         car_3.1-1                  </span></span>
<span><span class="co">#&gt;  [43] kernlab_0.9-31              prabclus_2.3-2             </span></span>
<span><span class="co">#&gt;  [45] BiocGenerics_0.42.0         DEoptimR_1.0-11            </span></span>
<span><span class="co">#&gt;  [47] abind_1.4-5                 scales_1.2.1               </span></span>
<span><span class="co">#&gt;  [49] DBI_1.1.3                   edgeR_3.38.4               </span></span>
<span><span class="co">#&gt;  [51] rstatix_0.7.1               Rcpp_1.0.9                 </span></span>
<span><span class="co">#&gt;  [53] viridisLite_0.4.1           xtable_1.8-4               </span></span>
<span><span class="co">#&gt;  [55] bit_4.0.5                   mclust_6.0.0               </span></span>
<span><span class="co">#&gt;  [57] stats4_4.2.2                htmlwidgets_1.6.0          </span></span>
<span><span class="co">#&gt;  [59] httr_1.4.4                  RColorBrewer_1.1-3         </span></span>
<span><span class="co">#&gt;  [61] fpc_2.2-9                   modeltools_0.2-23          </span></span>
<span><span class="co">#&gt;  [63] ellipsis_0.3.2              farver_2.1.1               </span></span>
<span><span class="co">#&gt;  [65] pkgconfig_2.0.3             XML_3.99-0.13              </span></span>
<span><span class="co">#&gt;  [67] flexmix_2.3-18              nnet_7.3-18                </span></span>
<span><span class="co">#&gt;  [69] sass_0.4.4                  dbplyr_2.2.1               </span></span>
<span><span class="co">#&gt;  [71] locfit_1.5-9.6              utf8_1.2.2                 </span></span>
<span><span class="co">#&gt;  [73] labeling_0.4.2              tidyselect_1.2.0           </span></span>
<span><span class="co">#&gt;  [75] rlang_1.0.6                 AnnotationDbi_1.58.0       </span></span>
<span><span class="co">#&gt;  [77] munsell_0.5.0               cellranger_1.1.0           </span></span>
<span><span class="co">#&gt;  [79] tools_4.2.2                 cachem_1.0.6               </span></span>
<span><span class="co">#&gt;  [81] cli_3.5.0                   generics_0.1.3             </span></span>
<span><span class="co">#&gt;  [83] RSQLite_2.2.20              broom_1.0.2                </span></span>
<span><span class="co">#&gt;  [85] evaluate_0.19               fastmap_1.1.0              </span></span>
<span><span class="co">#&gt;  [87] yaml_2.3.6                  ragg_1.2.4                 </span></span>
<span><span class="co">#&gt;  [89] knitr_1.41                  bit64_4.0.5                </span></span>
<span><span class="co">#&gt;  [91] fs_1.5.2                    robustbase_0.95-0          </span></span>
<span><span class="co">#&gt;  [93] KEGGREST_1.36.3             xml2_1.3.3                 </span></span>
<span><span class="co">#&gt;  [95] compiler_4.2.2              plotly_4.10.1              </span></span>
<span><span class="co">#&gt;  [97] curl_4.3.3                  png_0.1-8                  </span></span>
<span><span class="co">#&gt;  [99] ggsignif_0.6.4              reprex_2.0.2               </span></span>
<span><span class="co">#&gt; [101] geneplotter_1.74.0          bslib_0.4.2                </span></span>
<span><span class="co">#&gt; [103] stringi_1.7.8               highr_0.10                 </span></span>
<span><span class="co">#&gt; [105] desc_1.4.2                  lattice_0.20-45            </span></span>
<span><span class="co">#&gt; [107] Matrix_1.5-1                vctrs_0.5.1                </span></span>
<span><span class="co">#&gt; [109] pillar_1.8.1                lifecycle_1.0.3            </span></span>
<span><span class="co">#&gt; [111] jquerylib_0.1.4             data.table_1.14.6          </span></span>
<span><span class="co">#&gt; [113] bitops_1.0-7                GenomicRanges_1.48.0       </span></span>
<span><span class="co">#&gt; [115] R6_2.5.1                    IRanges_2.30.1             </span></span>
<span><span class="co">#&gt; [117] codetools_0.2-18            MASS_7.3-58.1              </span></span>
<span><span class="co">#&gt; [119] assertthat_0.2.1            SummarizedExperiment_1.26.1</span></span>
<span><span class="co">#&gt; [121] DESeq2_1.36.0               rprojroot_2.0.3            </span></span>
<span><span class="co">#&gt; [123] withr_2.5.0                 S4Vectors_0.34.0           </span></span>
<span><span class="co">#&gt; [125] GenomeInfoDbData_1.2.8      diptest_0.76-0             </span></span>
<span><span class="co">#&gt; [127] parallel_4.2.2              hms_1.1.2                  </span></span>
<span><span class="co">#&gt; [129] grid_4.2.2                  class_7.3-20               </span></span>
<span><span class="co">#&gt; [131] rmarkdown_2.19              MatrixGenerics_1.8.1       </span></span>
<span><span class="co">#&gt; [133] carData_3.0-5               googledrive_2.0.0          </span></span>
<span><span class="co">#&gt; [135] ggpubr_0.5.0                paintingr_0.1.0            </span></span>
<span><span class="co">#&gt; [137] Biobase_2.56.0              lubridate_1.9.0</span></span></code></pre></div>
</details>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Dean Li.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
